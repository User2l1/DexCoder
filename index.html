<script>
  // Check for saved user info
  const user = JSON.parse(localStorage.getItem('dexcoderUser'));

  // Redirect if not logged in
  if (!user || !user.username) {
    window.location.href = 'signup.html'; // Redirect to sign-up if not signed in
  } else {
    // Inject username and profile pic
    const header = document.querySelector('header');
    const userMenu = document.createElement('div');
    userMenu.style.display = 'flex';
    userMenu.style.alignItems = 'center';
    userMenu.style.cursor = 'pointer';
    userMenu.style.position = 'relative';

    const avatar = document.createElement('img');
    avatar.src = user.pfp || 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/2c/Default_pfp.svg/340px-Default_pfp.svg.png';
    avatar.alt = 'PFP';
    avatar.style.width = '32px';
    avatar.style.height = '32px';
    avatar.style.borderRadius = '50%';
    avatar.style.marginLeft = '15px';

    const menu = document.createElement('div');
    menu.style.position = 'absolute';
    menu.style.top = '40px';
    menu.style.right = '0';
    menu.style.background = 'var(--editor-bg)';
    menu.style.padding = '10px';
    menu.style.border = '1px solid var(--border-color)';
    menu.style.display = 'none';
    menu.style.zIndex = '999';

    const usernameEl = document.createElement('div');
    usernameEl.textContent = `Signed in as ${user.username}`;
    usernameEl.style.marginBottom = '10px';

    const logoutBtn = document.createElement('button');
    logoutBtn.textContent = 'Sign Out';
    logoutBtn.onclick = () => {
      localStorage.removeItem('dexcoderUser');
      location.reload();
    };

    menu.appendChild(usernameEl);
    menu.appendChild(logoutBtn);

    userMenu.appendChild(avatar);
    userMenu.appendChild(menu);

    avatar.onclick = () => {
      menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
    };

    header.appendChild(userMenu);
  }
</script>
